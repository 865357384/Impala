# no grouping exprs, cols contain nulls
select count(*), count(tinyint_col), min(tinyint_col), max(tinyint_col), sum(tinyint_col),
avg(tinyint_col)
from alltypesagg$TABLE
----
bigint, bigint, tinyint, tinyint, bigint, double
----
10000,9000,1,9,45000,5
=====
select count(*), count(smallint_col), min(smallint_col), max(smallint_col), sum(smallint_col),
avg(smallint_col)
from alltypesagg$TABLE
----
bigint, bigint, smallint, smallint, bigint, double
----
10000,9900,1,99,495000,50
=====
select count(*), count(int_col), min(int_col), max(int_col), sum(int_col), avg(int_col)
from alltypesagg$TABLE
----
bigint, bigint, int, int, bigint, double
----
10000,9990,1,999,4995000,500
=====
select count(*), count(bigint_col), min(bigint_col), max(bigint_col), sum(bigint_col),
avg(bigint_col)
from alltypesagg$TABLE
----
bigint, bigint, bigint, bigint, bigint, double
----
10000,9990,10,9990,49950000,5000
=====
select count(*), count(float_col), min(float_col), max(float_col), sum(float_col),
avg(float_col)
from alltypesagg$TABLE
----
bigint, bigint, float, float, double, double
----
10000,9990,1.1,1098.9,5.4945e+06,550
=====
select count(*), count(double_col), min(double_col), max(double_col), sum(double_col),
avg(double_col)
from alltypesagg$TABLE
----
bigint, bigint, double, double, double, double
----
10000,9990,10.1,10089.9,5.04495e+07,5050
=====
select count(*), min(string_col), max(string_col), min(date_string_col),
max(date_string_col) 
from alltypesagg$TABLE
----
bigint, string, string, string, string
----
10000,'0','999','01/01/10','01/10/10'
====
select min(timestamp_col), max(timestamp_col), avg(timestamp_col) from alltypesagg$TABLE
----
timestamp, timestamp, timestamp
----
2010-01-01 00:00:00,2010-01-10 18:02:05.100000000,2010-01-05 20:47:11.705086469
====
# grouping by different data types, with NULLs
select tinyint_col, count(*) from alltypesagg$TABLE group by 1
----
tinyint, bigint
----
4,1000
5,1000
6,1000
7,1000
8,1000
9,1000
NULL,1000
1,1000
2,1000
3,1000
====
# grouping by different data types, with NULLs, grouping expr missing from select list
select count(*) from alltypesagg$TABLE group by tinyint_col
----
bigint
----
1000
1000
1000
1000
1000
1000
1000
1000
1000
1000
====
select smallint_col % 10, count(*) from alltypesagg$TABLE group by 1
----
smallint, bigint
----
8,1000
9,1000
0,900
NULL,100
1,1000
2,1000
3,1000
4,1000
5,1000
6,1000
7,1000
====
select count(*) from alltypesagg$TABLE group by smallint_col % 10
----
bigint
----
100
1000
1000
1000
1000
1000
1000
1000
1000
1000
900
====
select int_col % 10, count(*) from alltypesagg$TABLE group by 1
----
int, bigint
----
8,1000
9,1000
0,990
NULL,10
1,1000
2,1000
3,1000
4,1000
5,1000
6,1000
7,1000
====
select count(*) from alltypesagg$TABLE group by int_col % 10
----
bigint
----
10
1000
1000
1000
1000
1000
1000
1000
1000
1000
990
====
select bigint_col % 100, count(*) from alltypesagg$TABLE group by 1
----
bigint, bigint
----
60,1000
10,1000
80,1000
30,1000
50,1000
0,990
NULL,10
70,1000
20,1000
90,1000
40,1000
====
select count(*) from alltypesagg$TABLE group by bigint_col % 100
----
bigint
----
10
1000
1000
1000
1000
1000
1000
1000
1000
1000
990
====
select date_string_col, count(*) from alltypesagg$TABLE group by 1
----
string, bigint
----
'01/08/10',1000
'01/01/10',1000
'01/10/10',1000
'01/09/10',1000
'01/04/10',1000
'01/05/10',1000
'01/06/10',1000
'01/02/10',1000
'01/03/10',1000
'01/07/10',1000
====
select count(*) from alltypesagg$TABLE group by date_string_col
----
bigint
----
1000
1000
1000
1000
1000
1000
1000
1000
1000
1000
====
# grouping by multiple exprs, with nulls
select tinyint_col % 3, smallint_col % 3, count(*) from alltypesagg$TABLE
where day = 1 group by 1, 2
----
tinyint, smallint, bigint
----
1,0,90
2,2,120
2,1,90
NULL,0,30
1,1,120
0,0,120
NULL,NULL,10
1,2,90
0,2,90
NULL,2,30
NULL,1,30
0,1,90
2,0,90
====
select count(*) from alltypesagg$TABLE
where day = 1 group by tinyint_col % 3, smallint_col % 3
----
bigint
----
10
120
120
120
30
30
30
90
90
90
90
90
90
====
# same result as previous query
select tinyint_col % 3, smallint_col % 3, count(*) from alltypesagg$TABLE where day = 1 group by 2, 1
----
tinyint, smallint, bigint
----
NULL,1,30
0,1,90
2,2,120
1,2,90
NULL,0,30
1,1,120
0,0,120
NULL,NULL,10
2,1,90
2,0,90
1,0,90
0,2,90
NULL,2,30
====
select tinyint_col % 2, smallint_col % 2, int_col % 2, bigint_col % 2, date_string_col, count(*)
from alltypesagg$TABLE
where date_string_col = '01/01/10' or date_string_col = '01/02/10'
group by 1, 2, 3, 4, 5
----
tinyint, smallint, int, bigint, string, bigint
----
NULL,NULL,0,0,'01/02/10',9
NULL,0,0,0,'01/02/10',90
0,0,0,0,'01/02/10',400
1,1,1,0,'01/02/10',500
NULL,NULL,NULL,NULL,'01/02/10',1
1,1,1,0,'01/01/10',500
NULL,NULL,0,0,'01/01/10',9
NULL,NULL,NULL,NULL,'01/01/10',1
0,0,0,0,'01/01/10',400
NULL,0,0,0,'01/01/10',90
====
select count(*)
from alltypesagg$TABLE
where date_string_col = '01/01/10' or date_string_col = '01/02/10'
group by tinyint_col % 2, smallint_col % 2, int_col % 2, bigint_col % 2, date_string_col
----
bigint
----
1
1
400
400
500
500
9
9
90
90
====
# no grouping cols, no matching rows
select count(*), min(tinyint_col), max(tinyint_col), sum(tinyint_col), avg(tinyint_col)
from alltypesagg$TABLE
where tinyint_col = -1
----
bigint, tinyint, tinyint, bigint, double
----
0,NULL,NULL,NULL,NULL
====
select count(*), min(smallint_col), max(smallint_col), sum(smallint_col), avg(smallint_col)
from alltypesagg$TABLE
where smallint_col = -1
----
bigint, smallint, smallint, bigint, double
----
0,NULL,NULL,NULL,NULL
=====
select count(*), min(int_col), max(int_col), sum(int_col), avg(int_col)
from alltypesagg$TABLE
where int_col = -1
----
bigint, int, int, bigint, double
----
0,NULL,NULL,NULL,NULL
=====
select count(*), min(bigint_col), max(bigint_col), sum(bigint_col), avg(bigint_col)
from alltypesagg$TABLE
where bigint_col = -1
----
bigint, bigint, bigint, bigint, double
----
0,NULL,NULL,NULL,NULL
=====
select count(*), min(float_col), max(float_col), sum(float_col), avg(float_col)
from alltypesagg$TABLE
where float_col < -1.0
----
bigint, float, float, double, double
----
0,NULL,NULL,NULL,NULL
=====
select count(*), min(double_col), max(double_col), sum(double_col), avg(double_col)
from alltypesagg$TABLE
where double_col < -1.0
----
bigint, double, double, double, double
----
0,NULL,NULL,NULL,NULL
====
# HAVING clauses over all aggregation functions, plus compound HAVING clauses
select int_col % 7, count(*), max(int_col) from alltypesagg$TABLE group by 1
----
int, bigint, int
----
4,1430,998
5,1430,999
6,1420,993
0,1420,994
NULL,10,NULL
1,1430,995
2,1430,996
3,1430,997
====
select int_col % 7, count(*) from alltypesagg$TABLE group by 1 having max(int_col) > 991
----
int, bigint
----
4,1430
5,1430
6,1420
0,1420
1,1430
2,1430
3,1430
====
select int_col % 7, count(*) from alltypesagg$TABLE group by 1
having max(int_col) > 991 and count(*) > 1420
----
int, bigint
----
4,1430
5,1430
1,1430
2,1430
3,1430
====
select int_col % 7, count(*) from alltypesagg$TABLE group by 1
having min(int_col) < 7
----
int, bigint
----
4,1430
5,1430
6,1420
1,1430
2,1430
3,1430
====
select int_col % 7, count(*) from alltypesagg$TABLE group by 1
having min(int_col) < 7 and count(*) > 1420
----
int, bigint
----
4,1430
5,1430
1,1430
2,1430
3,1430
====
select int_col % 7, count(*), sum(int_col) from alltypesagg$TABLE group by 1
----
int, bigint, bigint
----
4,1430,716430
5,1430,717860
6,1420,709290
0,1420,710710
NULL,10,NULL
1,1430,712140
2,1430,713570
3,1430,715000
====
select int_col % 7, count(*), sum(int_col) from alltypesagg$TABLE group by 1
having sum(int_col) >= 715000
----
int, bigint, bigint
----
4,1430,716430
5,1430,717860
3,1430,715000
====
select int_col % 7, count(*), sum(int_col) from alltypesagg$TABLE group by 1
having sum(int_col) >= 715000 or count(*) > 1420
----
int, bigint, bigint
----
4,1430,716430
5,1430,717860
1,1430,712140
2,1430,713570
3,1430,715000
====
select int_col % 7, count(*), sum(int_col) from alltypesagg$TABLE group by 1
having sum(int_col) is null
----
int, bigint, bigint
----
NULL,10,NULL
====
select int_col % 7, count(*), avg(int_col) from alltypesagg$TABLE group by 1
----
int, bigint, double
----
4,1430,501
5,1430,502
6,1420,499.5
0,1420,500.5
NULL,10,NULL
1,1430,498
2,1430,499
3,1430,500
====
select int_col % 7, count(*), avg(int_col) from alltypesagg$TABLE group by 1
having avg(int_col) > 500
----
int, bigint, double
----
4,1430,501
5,1430,502
0,1420,500.5
====
select int_col % 7, count(*), avg(int_col) from alltypesagg$TABLE group by 1
having avg(int_col) > 500 or count(*) = 10
----
int, bigint, double
----
4,1430,501
5,1430,502
0,1420,500.5
NULL,10,NULL
====
select timestamp_col, count(*) from alltypesagg$TABLE
group by timestamp_col having timestamp_col < cast('2010-01-01 01:05:20' as timestamp)
----
timestamp, bigint
----
2010-01-01 01:02:18.910000000,1
2010-01-01 00:26:03.250000000,1
2010-01-01 00:25:03,1
2010-01-01 00:31:04.650000000,1
2010-01-01 00:48:11.280000000,1
2010-01-01 00:37:06.660000000,1
2010-01-01 00:34:05.610000000,1
2010-01-01 01:03:19.530000000,1
2010-01-01 00:50:12.250000000,1
2010-01-01 00:30:04.350000000,1
2010-01-01 00:44:09.460000000,1
2010-01-01 00:52:13.260000000,1
2010-01-01 00:53:13.780000000,1
2010-01-01 00:16:01.200000000,1
2010-01-01 00:20:01.900000000,1
2010-01-01 00:46:10.350000000,1
2010-01-01 00:07:00.210000000,1
2010-01-01 00:42:08.610000000,1
2010-01-01 00:01:00,1
2010-01-01 00:13:00.780000000,1
2010-01-01 00:10:00.450000000,1
2010-01-01 00:12:00.660000000,1
2010-01-01 01:00:17.700000000,1
2010-01-01 00:22:02.310000000,1
2010-01-01 00:41:08.200000000,1
2010-01-01 00:00:00,1
2010-01-01 00:17:01.360000000,1
2010-01-01 00:21:02.100000000,1
2010-01-01 01:04:20.160000000,1
2010-01-01 00:55:14.850000000,1
2010-01-01 00:39:07.410000000,1
2010-01-01 00:29:04.600000000,1
2010-01-01 00:45:09.900000000,1
2010-01-01 00:54:14.310000000,1
2010-01-01 00:28:03.780000000,1
2010-01-01 00:56:15.400000000,1
2010-01-01 00:04:00.600000000,1
2010-01-01 00:59:17.110000000,1
2010-01-01 00:19:01.710000000,1
2010-01-01 00:23:02.530000000,1
2010-01-01 00:33:05.280000000,1
2010-01-01 01:01:18.300000000,1
2010-01-01 00:02:00.100000000,1
2010-01-01 00:27:03.510000000,1
2010-01-01 00:24:02.760000000,1
2010-01-01 00:47:10.810000000,1
2010-01-01 00:05:00.100000000,1
2010-01-01 00:18:01.530000000,1
2010-01-01 00:09:00.360000000,1
2010-01-01 00:14:00.910000000,1
2010-01-01 00:51:12.750000000,1
2010-01-01 00:08:00.280000000,1
2010-01-01 00:06:00.150000000,1
2010-01-01 00:15:01.500000000,1
2010-01-01 00:03:00.300000000,1
2010-01-01 00:36:06.300000000,1
2010-01-01 00:57:15.960000000,1
2010-01-01 00:58:16.530000000,1
2010-01-01 00:11:00.550000000,1
2010-01-01 00:32:04.960000000,1
2010-01-01 00:40:07.800000000,1
2010-01-01 00:35:05.950000000,1
2010-01-01 00:43:09.300000000,1
2010-01-01 00:49:11.760000000,1
2010-01-01 00:38:07.300000000,1
====
