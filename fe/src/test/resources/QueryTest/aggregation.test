# no grouping exprs, cols contain nulls
select count(*), count(tinyint_col), min(tinyint_col), max(tinyint_col), sum(tinyint_col),
avg(tinyint_col)
from alltypesagg
----
bigint, bigint, tinyint, tinyint, bigint, double
----
10000,9000,1,9,45000,5
=====
select count(*), count(smallint_col), min(smallint_col), max(smallint_col), sum(smallint_col),
avg(smallint_col)
from alltypesagg
----
bigint, bigint, smallint, smallint, bigint, double
----
10000,9900,1,99,495000,50
=====
select count(*), count(int_col), min(int_col), max(int_col), sum(int_col), avg(int_col)
from alltypesagg
----
bigint, bigint, int, int, bigint, double
----
10000,9990,1,999,4995000,500
=====
select count(*), count(bigint_col), min(bigint_col), max(bigint_col), sum(bigint_col),
avg(bigint_col)
from alltypesagg
----
bigint, bigint, bigint, bigint, bigint, double
----
10000,9990,10,9990,49950000,5000
=====
select count(*), count(float_col), min(float_col), max(float_col), sum(float_col),
avg(float_col)
from alltypesagg
----
bigint, bigint, float, float, double, double
----
10000,9990,1.1,1098.9,5.4945e+06,550
=====
select count(*), count(double_col), min(double_col), max(double_col), sum(double_col),
avg(double_col)
from alltypesagg
----
bigint, bigint, double, double, double, double
----
10000,9990,10.1,10089.9,5.04495e+07,5050
=====
select count(*), min(string_col), max(string_col), min(date_string_col), max(date_string_col) 
from alltypesagg
----
bigint, string, string, string, string
----
10000,'0','999','01/01/10','01/10/10'
# grouping by different data types, with NULLs
select tinyint_col, count(*) from alltypesagg group by 1
----
tinyint, bigint
----
4,1000
5,1000
6,1000
7,1000
8,1000
9,1000
NULL,1000
1,1000
2,1000
3,1000
====
select smallint_col % 10, count(*) from alltypesagg group by 1
----
smallint, bigint
----
8,1000
9,1000
0,900
NULL,100
1,1000
2,1000
3,1000
4,1000
5,1000
6,1000
7,1000
====
select int_col % 10, count(*) from alltypesagg group by 1
----
int, bigint
----
8,1000
9,1000
0,990
NULL,10
1,1000
2,1000
3,1000
4,1000
5,1000
6,1000
7,1000
====
select bigint_col % 100, count(*) from alltypesagg group by 1
----
bigint, bigint
----
60,1000
10,1000
80,1000
30,1000
50,1000
0,990
NULL,10
70,1000
20,1000
90,1000
40,1000
====
# TODO: group by string col
select date_string_col, count(*) from alltypesagg group by 1
----
string, bigint
----
'01/08/10',1000
'01/01/10',1000
'01/10/10',1000
'01/09/10',1000
'01/04/10',1000
'01/05/10',1000
'01/06/10',1000
'01/02/10',1000
'01/03/10',1000
'01/07/10',1000
====
# grouping by multiple exprs, with nulls
select tinyint_col % 3, smallint_col % 3, count(*) from alltypesagg where day = 1 group by 1, 2
----
tinyint, smallint, bigint
----
1,0,90
2,2,120
2,1,90
NULL,0,30
1,1,120
0,0,120
NULL,NULL,10
1,2,90
0,2,90
NULL,2,30
NULL,1,30
0,1,90
2,0,90
====
# same result as previous query
select tinyint_col % 3, smallint_col % 3, count(*) from alltypesagg where day = 1 group by 2, 1
----
tinyint, smallint, bigint
----
NULL,1,30
0,1,90
2,2,120
1,2,90
NULL,0,30
1,1,120
0,0,120
NULL,NULL,10
2,1,90
2,0,90
1,0,90
0,2,90
NULL,2,30
====
select tinyint_col % 2, smallint_col % 2, int_col % 2, bigint_col % 2, date_string_col, count(*)
from alltypesagg
where date_string_col = '01/01/10' or date_string_col = '01/02/10'
group by 1, 2, 3, 4, 5
----
tinyint, smallint, int, bigint, string, bigint
----
NULL,NULL,0,0,'01/02/10',9
NULL,0,0,0,'01/02/10',90
0,0,0,0,'01/02/10',400
1,1,1,0,'01/02/10',500
NULL,NULL,NULL,NULL,'01/02/10',1
1,1,1,0,'01/01/10',500
NULL,NULL,0,0,'01/01/10',9
NULL,NULL,NULL,NULL,'01/01/10',1
0,0,0,0,'01/01/10',400
NULL,0,0,0,'01/01/10',90
====
# no grouping cols, no matching rows
select count(*), min(tinyint_col), max(tinyint_col), sum(tinyint_col), avg(tinyint_col)
from alltypesagg
where tinyint_col = -1
----
bigint, tinyint, tinyint, bigint, double
----
0,NULL,NULL,NULL,NULL
====
select count(*), min(smallint_col), max(smallint_col), sum(smallint_col), avg(smallint_col)
from alltypesagg
where smallint_col = -1
----
bigint, smallint, smallint, bigint, double
----
0,NULL,NULL,NULL,NULL
=====
select count(*), min(int_col), max(int_col), sum(int_col), avg(int_col)
from alltypesagg
where int_col = -1
----
bigint, int, int, bigint, double
----
0,NULL,NULL,NULL,NULL
=====
select count(*), min(bigint_col), max(bigint_col), sum(bigint_col), avg(bigint_col)
from alltypesagg
where bigint_col = -1
----
bigint, bigint, bigint, bigint, double
----
0,NULL,NULL,NULL,NULL
=====
select count(*), min(float_col), max(float_col), sum(float_col), avg(float_col)
from alltypesagg
where float_col < -1.0
----
bigint, float, float, double, double
----
0,NULL,NULL,NULL,NULL
=====
select count(*), min(double_col), max(double_col), sum(double_col), avg(double_col)
from alltypesagg
where double_col < -1.0
----
bigint, double, double, double, double
----
0,NULL,NULL,NULL,NULL
====
# HAVING clauses over all aggregation functions, plus compound HAVING clauses
select int_col % 7, count(*), max(int_col) from alltypesagg group by 1
----
int, bigint, int
----
4,1430,998
5,1430,999
6,1420,993
0,1420,994
NULL,10,NULL
1,1430,995
2,1430,996
3,1430,997
====
select int_col % 7, count(*) from alltypesagg group by 1 having max(int_col) > 991
----
int, bigint
----
4,1430
5,1430
6,1420
0,1420
1,1430
2,1430
3,1430
====
select int_col % 7, count(*) from alltypesagg group by 1
having max(int_col) > 991 and count(*) > 1420
----
int, bigint
----
4,1430
5,1430
1,1430
2,1430
3,1430
====
select int_col % 7, count(*) from alltypesagg group by 1
having min(int_col) < 7
----
int, bigint
----
4,1430
5,1430
6,1420
1,1430
2,1430
3,1430
====
select int_col % 7, count(*) from alltypesagg group by 1
having min(int_col) < 7 and count(*) > 1420
----
int, bigint
----
4,1430
5,1430
1,1430
2,1430
3,1430
====
select int_col % 7, count(*), sum(int_col) from alltypesagg group by 1
----
int, bigint, bigint
----
4,1430,716430
5,1430,717860
6,1420,709290
0,1420,710710
NULL,10,NULL
1,1430,712140
2,1430,713570
3,1430,715000
====
select int_col % 7, count(*), sum(int_col) from alltypesagg group by 1
having sum(int_col) >= 715000
----
int, bigint, bigint
----
4,1430,716430
5,1430,717860
3,1430,715000
====
select int_col % 7, count(*), sum(int_col) from alltypesagg group by 1
having sum(int_col) >= 715000 or count(*) > 1420
----
int, bigint, bigint
----
4,1430,716430
5,1430,717860
1,1430,712140
2,1430,713570
3,1430,715000
====
select int_col % 7, count(*), sum(int_col) from alltypesagg group by 1
having sum(int_col) is null
----
int, bigint, bigint
----
NULL,10,NULL
====
select int_col % 7, count(*), avg(int_col) from alltypesagg group by 1
----
int, bigint, double
----
4,1430,501
5,1430,502
6,1420,499.5
0,1420,500.5
NULL,10,NULL
1,1430,498
2,1430,499
3,1430,500
====
select int_col % 7, count(*), avg(int_col) from alltypesagg group by 1
having avg(int_col) > 500
----
int, bigint, double
----
4,1430,501
5,1430,502
0,1420,500.5
====
select int_col % 7, count(*), avg(int_col) from alltypesagg group by 1
having avg(int_col) > 500 or count(*) = 10
----
int, bigint, double
----
4,1430,501
5,1430,502
0,1420,500.5
NULL,10,NULL
====
