# Q9 - Product Type Measure Query
# Modifications: Added limit, added round() call
select nation, o_year, round(sum(amount), 5) as sum_profit
from
( select n_name as nation, year(o_orderdate) as o_year,
  l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
  from orders$TABLE o
  join
    ( select l_extendedprice, l_discount, l_quantity, l_orderkey, n_name, ps_supplycost
      from part$TABLE p
      join
        ( select l_extendedprice, l_discount, l_quantity, l_partkey, l_orderkey,
          n_name, ps_supplycost
          from partsupp$TABLE ps
          join
            ( select l_suppkey, l_extendedprice, l_discount, l_quantity, l_partkey,
              l_orderkey, n_name
              from
              ( select s_suppkey, n_name
                from nation$TABLE n
                join supplier$TABLE s
                  on n.n_nationkey = s.s_nationkey
              ) s1
              join lineitem$TABLE l
                on s1.s_suppkey = l.l_suppkey
            ) l1
            on ps.ps_suppkey = l1.l_suppkey and
               ps.ps_partkey = l1.l_partkey
        ) l2
          on p.p_name like '%green%' and
             p.p_partkey = l2.l_partkey
   ) l3
        on o.o_orderkey = l3.l_orderkey
) profit
group by nation, o_year
order by nation, o_year desc
limit 101
---- TYPES
string, int, double
---- RESULTS
'ALGERIA',1992,45636849.4881
'ALGERIA',1993,46044207.7838
'ALGERIA',1994,48694008.0668
'ALGERIA',1995,44402273.5999
'ALGERIA',1996,48285482.6782
'ALGERIA',1997,48611833.4962
'ALGERIA',1998,27136900.1803
'ARGENTINA',1992,46654240.7487
'ARGENTINA',1993,48605593.6162
'ARGENTINA',1994,48268856.3547
'ARGENTINA',1995,45631769.2054
'ARGENTINA',1996,45255278.6021
'ARGENTINA',1997,47143964.1176
'ARGENTINA',1998,28341663.7848
'BRAZIL',1992,45280216.8027
'BRAZIL',1993,45766603.7379
'BRAZIL',1994,44854218.8932
'BRAZIL',1995,44015888.5132
'BRAZIL',1996,45090647.163
'BRAZIL',1997,45640660.7677
'BRAZIL',1998,26527736.396
'CANADA',1992,45873849.6882
'CANADA',1993,46634791.1121
'CANADA',1994,46691491.9596
'CANADA',1995,47311993.0441
'CANADA',1996,46307936.1108
'CANADA',1997,44849954.3186
'CANADA',1998,26828985.3944
'CHINA',1992,46949457.6426
'CHINA',1993,49634673.9463
'CHINA',1994,46397896.6097
'CHINA',1995,46734651.4838
'CHINA',1996,49532807.0601
'CHINA',1997,46123865.4097
'CHINA',1998,27510180.1657
'EGYPT',1992,47000574.5027
'EGYPT',1993,49133627.6471
'EGYPT',1994,47194895.228
'EGYPT',1995,45897160.6783
'EGYPT',1996,47745727.545
'EGYPT',1997,47674857.6783
'EGYPT',1998,28401491.7968
'ETHIOPIA',1992,44385735.6813
'ETHIOPIA',1993,42622804.1616
'ETHIOPIA',1994,41597208.5283
'ETHIOPIA',1995,43575757.3343
'ETHIOPIA',1996,43636287.1922
'ETHIOPIA',1997,43010596.0838
'ETHIOPIA',1998,25135046.1377
'FRANCE',1992,44052308.429
'FRANCE',1993,43729961.0639
'FRANCE',1994,43447352.9922
'FRANCE',1995,46377408.4328
'FRANCE',1996,43306317.9749
'FRANCE',1997,42392969.4731
'FRANCE',1998,26210392.2804
'GERMANY',1992,44361141.2107
'GERMANY',1993,45126645.9113
'GERMANY',1994,44616995.4369
'GERMANY',1995,43314338.3077
'GERMANY',1996,45882074.8049
'GERMANY',1997,43968355.8079
'GERMANY',1998,25991257.1071
'INDIA',1992,47914303.1234
'INDIA',1993,48112766.6987
'INDIA',1994,50106952.4261
'INDIA',1995,49344062.2829
'INDIA',1996,47571018.5122
'INDIA',1997,51386111.3448
'INDIA',1998,29626417.2379
'INDONESIA',1992,45185777.0688
'INDONESIA',1993,46147963.7895
'INDONESIA',1994,45988483.8772
'INDONESIA',1995,45593622.6993
'INDONESIA',1996,44746729.8078
'INDONESIA',1997,44593812.9863
'INDONESIA',1998,27734909.6763
'IRAN',1992,43052338.4143
'IRAN',1993,45362775.8094
'IRAN',1994,43696360.4795
'IRAN',1995,44414285.2348
'IRAN',1996,45891397.0992
'IRAN',1997,45019114.1696
'IRAN',1998,26661608.9301
'IRAQ',1992,47562355.6571
'IRAQ',1993,47435691.5082
'IRAQ',1994,48795847.231
'IRAQ',1995,48774801.7275
'IRAQ',1996,50036593.8404
'IRAQ',1997,48585307.5222
'IRAQ',1998,31188498.1914
'JAPAN',1992,39113493.9052
'JAPAN',1993,39589074.2771
'JAPAN',1994,41159518.3058
'JAPAN',1995,40925317.465
'JAPAN',1996,40267778.9094
'JAPAN',1997,42377052.3454
'JAPAN',1998,24694102.172
'JORDAN',1996,41860855.4684
'JORDAN',1997,41615962.6619
'JORDAN',1998,23489867.7893
====
