# Q17 - Small-Quantity-Order Revenue Query
insert overwrite table lineitem_tmp$TABLE
select l_partkey as t_partkey, 0.2 * avg(l_quantity) as t_avg_quantity
from lineitem$TABLE
group by l_partkey
---- SETUP
RESET lineitem_tmp$TABLE
RELOAD lineitem_tmp$TABLE
---- RESULTS
---- NUMROWS
200000
====
# Modifications: Added round() call
select round(sum(l_extendedprice) / 7.0, 5) as avg_yearly
from
( select l_quantity, l_extendedprice, t_avg_quantity
  from lineitem_tmp$TABLE t
  join
  ( select l_quantity, l_partkey, l_extendedprice
    from part$TABLE p
    join lineitem$TABLE l
      on p.p_partkey = l.l_partkey and
         p.p_brand = 'Brand#23' and
         p.p_container = 'MED BOX'
  ) l1
    on l1.l_partkey = t.t_partkey
) a
where l_quantity < t_avg_quantity
---- TYPES
double
---- RESULTS
348406.05429
====
