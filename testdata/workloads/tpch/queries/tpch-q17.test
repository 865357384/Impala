====
---- QUERY: TPCH-Q17
select sum(l_extendedprice) / 7.0 as avg_yearly
from lineitem l
  join part p
    on (p.p_partkey = l.l_partkey)
  join ( select  l_partkey as t_partkey,
                 0.2 * avg(l_quantity) as t_avg_quantity
         from lineitem group by l_partkey ) as lt
    on (lt.t_partkey = p.p_partkey)
where
  p.p_brand = 'Brand#23' and
  p.p_container = 'MED BOX' and
  l.l_quantity  < lt.t_avg_quantity
---- RESULTS
348406.05
---- TYPES
decimal
====