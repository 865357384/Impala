From 9c1027c4e2137455c53d6596961969f336a36ac2 Mon Sep 17 00:00:00 2001
From: Peter Somogyi <psomogyi@cloudera.com>
Date: Tue, 8 Jan 2019 10:16:50 +0100
Subject: [PATCH 482/489] CDH-76406 Precommit failure on C5

==C5_APPROVED_BUGFIX==

Change-Id: Iec09bc6edddc69a6314087c48fd7bf45eae56389
---
 cloudera/cdh-personality.sh |   12 ++++++++++++
 cloudera/pre_commit_hook.sh |    2 +-
 2 files changed, 13 insertions(+), 1 deletion(-)

diff --git a/cloudera/cdh-personality.sh b/cloudera/cdh-personality.sh
index de84a50..ad7c224 100644
--- a/cloudera/cdh-personality.sh
+++ b/cloudera/cdh-personality.sh
@@ -292,3 +292,15 @@ function mvnsite_filefilter
   fi
 }
 
+## @description  Adds mount points of repositories to DOCKER_EXTRAARGS.
+## @audience     private
+## @stability    evolving
+function hbase_docker_support
+{
+  # Yetus needs an upstream branch for source of truth. See 'cloudera/pre_commit_hook.sh'.
+  # In Docker mode the repository is on a different path and does not have access to 'fake_upstream'
+  # and back to the original path. We need to mount these by adding to DOCKER_EXTRAARGS.
+  yetus_debug "Adding repositories as mount points to DOCKER_EXTRAARGS"
+  DOCKER_EXTRAARGS=("${DOCKER_EXTRAARGS[@]}" -v "/data/jenkins/workspace/hbase-pre-commit/fake_upstream:/data/jenkins/workspace/hbase-pre-commit/fake_upstream")
+  DOCKER_EXTRAARGS=("${DOCKER_EXTRAARGS[@]}" -v "/data/jenkins/workspace/hbase-pre-commit/repos/hbase:/data/jenkins/workspace/hbase-pre-commit/repos/hbase")
+}
diff --git a/cloudera/pre_commit_hook.sh b/cloudera/pre_commit_hook.sh
index fe190b4..6c477c5a 100644
--- a/cloudera/pre_commit_hook.sh
+++ b/cloudera/pre_commit_hook.sh
@@ -103,7 +103,7 @@ cd "${COMPONENT}"
 git format-patch --stdout -1 "${GIT_COMMIT}" >"${PATCHFILE}"
 # Yetus in robot mode needs an upstream git branch that it can use as the source
 # of truth about what the working checkout should look like before it applies
-# the patch. Unfortunately, Gerrit doesn't maintain a breanch for each proposed
+# the patch. Unfortunately, Gerrit doesn't maintain a branch for each proposed
 # changeset so we can't just add GIT_BRANCH as a remote.  origin/GERRIT_BRANCH
 # points to the head of changes that have been merged already. So if we want to
 # support chains of proposed reviews such that those after the first can build,
-- 
1.7.9.5

